<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Iteration Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #chart-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
        input, button {
            margin: 10px 0;
            padding: 5px;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Function Iteration Visualizer</h1>
    <label for="function">Enter function (use 'x' as variable):</label>
    <input type="text" id="function" value="sqrt(x)" placeholder="e.g., sqrt(x)">
    <br>
    <label for="x-start">Starting point:</label>
    <input type="number" id="x-start" value="0.9" step="0.1">
    <br>
    <label for="min-error">Minimum error:</label>
    <input type="number" id="min-error" value="0.001" step="0.001">
    <br>
    <label for="max-iterations">Maximum iterations:</label>
    <input type="number" id="max-iterations" value="10">
    <br>
    <button onclick="runIteration()">Run Iteration</button>
    <div id="result"></div>
    <div id="chart-container">
        <canvas id="chart"></canvas>
    </div>

    <script>
        let chart;

        function iteration(givenFunction, x0, minError = 0.001, maxIteration = 10) {
            let i = 0;
            let error = 1;
            let xp = [];
            let x = null;

            while (error > minError && i < maxIteration) {
                x = givenFunction(x0);
                error = Math.abs(x0 - x);
                x0 = x;
                xp.push(x0);
                i++;
            }

            return [x, xp];
        }

        function createPlot(xf, xp, xStart, givenFunction) {
            const ctx = document.getElementById('chart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const x = Array.from({length: 100}, (_, i) => i * 0.02);
            const y = x.map(givenFunction);
            const yp = xp.map(givenFunction);

            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Function',
                            data: x.map((x, i) => ({x, y: y[i]})),
                            showLine: true,
                            borderColor: 'blue',
                            pointRadius: 0
                        },
                        {
                            label: 'Iteration Points',
                            data: xp.map((x, i) => ({x, y: yp[i]})),
                            backgroundColor: 'blue',
                            pointRadius: 5
                        },
                        {
                            label: 'Starting Point',
                            data: [{x: xStart, y: givenFunction(xStart)}],
                            backgroundColor: 'red',
                            pointRadius: 5
                        },
                        {
                            label: 'Final Point',
                            data: [{x: xf, y: givenFunction(xf)}],
                            backgroundColor: 'green',
                            pointRadius: 5
                        },
                        {
                            label: 'y = x',
                            data: x.map(x => ({x, y: x})),
                            showLine: true,
                            borderColor: 'black',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function runIteration() {
            const functionStr = document.getElementById('function').value;
            const xStart = parseFloat(document.getElementById('x-start').value);
            const minError = parseFloat(document.getElementById('min-error').value);
            const maxIterations = parseInt(document.getElementById('max-iterations').value);

            try {
                const givenFunction = math.parse(functionStr).compile();
                const func = x => givenFunction.evaluate({x: x});

                const [xf, xp] = iteration(func, xStart, minError, maxIterations);

                document.getElementById('result').textContent = `Final value: ${xf.toFixed(6)}`;
                createPlot(xf, xp, xStart, func);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
